var Dashboard,hasProp={}.hasOwnProperty;Dashboard={},function(window,document,$,_,Backbone,Dashboard){var Component,Components,Variable,Variables,addComponent,adhoc,background,button,chart,checkbox,custom,datepicker,daterangepicker,getAllVariables,getFilters,getVariable,header,image,init,input,notFilters,rangeSelection,ref,removeComponent,resetAll,resetAllVariables,resetComponent,resetComponents,select,select2,separator,setVariable,slider,table,template,text,updateComponent,updateComponentOptions;Dashboard.VERSION="0.1.0",Variable=Backbone.Model.extend({initialize:function(t){this.set("id",t.name)},defaults:{name:null,value:null},idAttribute:"name"}),Component=Backbone.Model.extend({initialize:function(t){this.set("id",t.uid||t.name),this.setupParameters(),this.setupListeners(),_.bindAll(this,"update"),this.listenTo(this,"change:listeners",this.setupListeners),this.listenTo(this,"change:parameters",this.setupParameters)},defaults:{name:null,options:{},listeners:[],parameters:[],requestParameters:{},executeAtStart:!1,_data:null,_subjects:null,_params:null},setupParameters:function(){var t,e,i;if(_.isArray(this.get("parameters"))&&this.get("parameters").length>0)return e=this.get("parameters"),t=_.difference(e,Dashboard.variables.pluck("name")),t.length>0&&console.warn("These variables do not exist : "+t.join(",")),i=new Backbone.VirtualCollection(Dashboard.variables,{filter:function(t){return $.inArray(t.get("id"),e)>=0}}),this.set("_params",i)},setupListeners:function(){var t,e,i;if(_.isArray(this.get("listeners"))&&this.get("listeners").length>0)return e=this.get("listeners"),t=_.difference(e,Dashboard.variables.pluck("name")),t.length>0&&console.warn("These variables do not exist : "+t.join(",")),i=new Backbone.VirtualCollection(Dashboard.variables,{filter:function(t){return $.inArray(t.get("id"),e)>=0}}),this.set("_subjects",i)},update:function(){var t,e,i,a,s,o,n,r,l,d,p,h,c,u,m,g;if(u=this,o={},this.get("adhoc")&&"select2"!==this.get("adhoc"))o=_.clone(this.get("dataSource")),this.get("columns")?(a=this.get("columns"),d=[],r=this.get("database"),a.forEach(function(t){var e,i;i=""!==r?r+"."+t.column.replace(/^\./,""):t.column.replace(/^\./,""),e=t.alias||t.column.replace(/\./g,"_"),d.push({column:i,alias:e})}),o.columns=d):(i=(this.get("database")+"."+this.get("column")).replace(/^\./,""),e=this.get("alias")||this.get("column").replace(/\./g,"_"),o.columns=[{column:i,alias:e}]),t=this.get("aggregate"),n=this.get("databaseFunction"),h=this.get("orderBy"),o.limitBy="full",o.distinctResults=!0,""!==h&&void 0!==h&&void 0!==e?o.functions={orderBy:[{alias:e,order:h,custom:!0}]}:o.functions={},n&&Object.keys(n).length&&o.columns.forEach(function(t){return t.databaseFunction=n}),Array.isArray(t)&&t.length&&("object"==typeof t[0]?(s=this.get("database"),t.forEach(function(t){var e;i=""!==s?s+"."+t.column.replace(/^\./,""):t.column.replace(/^\./,""),e=t.column.replace(/\./g,"_"),t.column=i,o.columns.forEach(function(t){t.column===i&&(t.aggregate=!0)})}),o.functions.aggregate=t,o.refresh=!0):(o.columns[0].aggregate=!0,i=(this.get("database")+"."+this.get("column")).replace(/^\./,""),e=this.get("alias")||this.get("column").replace(/\./g,"_"),o.functions.aggregate=[{column:i,"function":t.join("_"),alias:e}])),window.urlParameters&&window.urlParameters.refresh&&(o.refresh=!0),g=$.post(window.DashboardGlobals.services,{type:"adhoc",serviceType:"report",service:"fetchData",formData:window.Base64.encode(JSON.stringify(o))},function(t){"string"==typeof t&&(t=JSON.parse(t)),t.status&&u.set("_data",t.response)});else if(void 0!==this.get("map")){c=this.get("requestParameters");for(p in c)hasProp.call(c,p)&&(m=c[p],o[p]=Dashboard.getVariable(m));o.dir=window.DashboardGlobals.efwddir||window.DashboardGlobals.folderpath,o.map_id=this.get("map"),this.get("dir")&&(o.dir=this.get("dir")),l=this.get("efwd"),l&&l.file&&(o.efwd=l),g=$.post(window.DashboardGlobals.updateService,{data:window.Base64.encode(JSON.stringify(o).replace(/"(\[)\\/g,"$1").replace(/\\("\])"/g,"$1"))},function(t,e,i){"string"==typeof t&&(t=JSON.parse(t)),u.set("_data",t)}),g.identifier=this.get("name")}return g},idAttribute:"name",validate:function(t,e){return"string"!=typeof t.name?"A name must be provided for "+t.type+" component":"string"!=typeof t.type?"Component type must be specified":"string"!=typeof t.htmlElementId?"An HTML id attribute must be provided":void 0}}),Variables=Backbone.Collection.extend({model:Variable}),Components=Backbone.Collection.extend({model:Component,initialize:function(t){this.listenTo(this,"add",this.addComponent)},addComponent:function(t,e,i){var a,s;if(a=t.get("type"),!Dashboard.Components.hasOwnProperty(a))throw new Error("Component of type <b>'"+a.toString()+"'</b> does not exist");s=new(Dashboard.Components[a.toLowerCase()])({model:t,el:t.get("htmlElementId"),id:t.get("id")}),s.render(),s.model.get("executeAtStart")===!0&&"function"==typeof s.model.update&&s.model.update.call(s.model),Dashboard.componentViews[t.get("id")]=s}}),Dashboard.components=new Components([]),Dashboard.variables=new Variables([]),Dashboard.componentViews={},Dashboard.components.on("invalid",function(t,e){throw e}),Dashboard.components.on("reset",function(t,e){var i,a,s,o,n;for(o=e.previousModels,n=[],i=0,a=o.length;i<a;i++)s=o[i],n.push(s.trigger("remove"));return n}),Dashboard.variables.on("add",function(t){}),Dashboard.variables.on("invalid",function(t,e){throw e}),Dashboard.Components={},notFilters=["adhoc","button","chart","table","header","image","separator","text","background"],setVariable=function(){var t,e,i,a;if(0===arguments.length)return!1;if(a=[],2===arguments.length&&"string"==typeof arguments[0])a.push({name:arguments[0],value:arguments[1]});else if(_.isObject(arguments[0])){e=arguments[0];for(t in e)hasProp.call(e,t)&&(i=e[t],a.push({name:t,value:i}))}Dashboard.variables.add(a,{merge:!0})},init=function(t){if(resetComponents(),!_.isArray(t))throw new Error("Dashboard.init(): Parameter is expected to be an array but "+typeof t+" given");$(document).ready(function(){var e,i,a,s,o,n,r,l,d;r={},_.isObject(window.reportParameters)&&_.isObject(window.reportParameters.reportParameters)&&(_.assign(r,window.reportParameters.reportParameters),window.reportParameters.reportParameters=null),_.isObject(window.urlParameters)&&(_.assign(r,_.omit(window.urlParameters,["dir","file","execute","refresh","parameters"])),window.urlParameters.parameters=null),_.isObject(window.parameters)&&(_.assign(r,window.parameters),window.parameters=null),t.forEach(function(t){var e,i,a;if(i=t.listeners,a=Object.keys(r),e=_.intersection(i,a),e.length>0)return t.executeAtStart=!0}),d=getAllVariables();for(o in d)hasProp.call(d,o)&&(l=d[o],_.isArray(l)&&_.isString(r[o])&&(r[o]=[r[o]]));if(setVariable(r),_.isObject(window.urlParameters)&&window.urlParameters.execute)for(a=window.urlParameters.execute,_.isString(a)&&(a=[a]),s=0,n=a.length;s<n;s++)i=a[s],e=Dashboard.components.get(i),e&&_.isFunction(e.update)&&setTimeout(e.update,200);return Dashboard.components.add(t,{validate:!0})})},addComponent=function(t){return Dashboard.components.add(t,{validate:!0})},removeComponent=function(t){var e;if(Dashboard.components.remove(t),e=Dashboard.componentViews[t],e&&"function"==typeof e.close)return e.close()},resetComponents=function(){Dashboard.components.reset([]),Dashboard.componentViews={}},updateComponent=function(t){var e;return e=Dashboard.components.get(t),!(!e||"function"!=typeof e.update)&&(e.update(),!0)},resetAll=function(){resetComponents(),Dashboard.variables.reset([])},resetAllVariables=function(){Dashboard.variables.reset([])},getVariable=function(t){return Dashboard.variables.get(t)?Dashboard.variables.get(t).get("value"):null},getFilters=function(){return Dashboard.components.toJSON().filter(function(t){return notFilters.indexOf(t.type)<0}).map(function(t){return _.omit(t,function(t,e){return"_"===e.charAt(0)})})},getAllVariables=function(){var t,e;return t=Dashboard.variables.pluck("name"),e=Dashboard.variables.pluck("value"),_.object(t,e)},resetComponent=function(t){var e;return e=Dashboard.components.get(t),!!e&&(e.set("_data",null),!0)},updateComponentOptions=function(t,e){var i,a;return a=Dashboard.components.get(t),e=_.omit(e,function(t,e){return"_"===e.charAt(0)}),i=_.omit(a.attributes,function(t,e){return"_"===e.charAt(0)}),i=_.cloneDeep(i),i=_.merge(i,e),a.get("type")!==i.type?(Dashboard.removeComponent(t),Dashboard.addComponent(i)):(a.set(i,{silent:!1}),"function"==typeof a.update?a.update():void 0)},Dashboard.setVariable=setVariable,Dashboard.init=init,Dashboard.addComponent=addComponent,Dashboard.removeComponent=removeComponent,Dashboard.updateComponent=updateComponent,Dashboard.resetAll=resetAll,Dashboard.resetAllVariables=resetAllVariables,Dashboard.getVariable=getVariable,Dashboard.getAllVariables=getAllVariables,Dashboard.getFilters=getFilters,Dashboard.resetComponent=resetComponent,Dashboard.updateComponentOptions=updateComponentOptions,_.templateSettings={interpolate:/\{\{(.*?)\}\}/g},Dashboard.Templates={},Dashboard.Templates.select='<select {{ multiple }} class="form-control"></select>',Dashboard.Templates.input='<input type="text" name="input_control" style="width:100%;height:15%;z-index:1">',Dashboard.Templates.option='<option value="{{ value }}">{{ display }}</option>',Dashboard.Templates.select2='<input type="hidden" style="width:100%">',Dashboard.Templates.checkbox='<select {{ multiple }} class="hi_checkbox"></select>',Dashboard.Templates.rangeSelection='<div> <div class="col-md-12"> <div class="col-md-6 col-sm-6 col-xs-12"> <label>starting value:</label> <input type="hidden" name="srtVal_select" style="width:100%"> </div> <div class="col-md-6 col-sm-6 col-xs-12"> <label>ending value:</label> <input type="hidden" name="endValue_select" style="width:100%"> </div> </div> <div class="col-md-12 col-sm-12 col-xs-12"><span style="color:#a94442">Formats for the filter values are wrong.</span></div> </div>',Dashboard.Templates.slider='<div class="custom_range_slider"> <input name="rangeValues"  class="range_slider_input" readonly/> <div type="rangeslider" style="width:100%"></div> </div>',Dashboard.Templates.adhoc='<iframe src="{{url}}" name="{{name}}" class="adhoc-frame" style="border:none;width:100%;min-height:1px"></iframe>',Dashboard.Templates.datepicker='<div class="input-group"> <input name="date" class="form-control sb-disable-close"> <span class="input-group-addon pointer"> <i class="glyphicon glyphicon-calendar"></i> </span> </div>',Dashboard.Templates.daterangepicker='<div class="input-group"> <input name="daterange" class="form-control sb-disable-close"> <span class="input-group-addon pointer"> <i class="glyphicon glyphicon-calendar"></i> </span> </div>',Dashboard.Templates.button='<button class="btn {{ classes }}">{{ display }}</button>',Dashboard.Templates.chart='<div class="chart" id="{{id}}"></div> <script>{{script}}</script>',Dashboard.Templates.chartMenu='<div class="print-menu group pull-right"> <div class="btn-group"> <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"> {{ label }} <span class="caret"></span> </button> <ul class="dropdown-menu" role="menu"></ul> </div> </div>',Dashboard.Templates.chartMenuItem='<li><a href="#" id="{{ id }}">{{ display }}</a></li>',Dashboard.Templates.chartMenuItemSeparator='<li class="divider"></li>',Dashboard.Templates.alert='<div class="alert alert-{{type}} alert-fixed-{{position}} fade in"> <button type="button" class="close" data-dismiss="alert"> <span aria-hidden="true">&times;</span> <span class="sr-only">Close</span> </button> {{message}} </div>',Dashboard.Templates.modal='<div id="dashboard-modal" class="modal fade" data-backdrop="static"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h4 class="modal-title">{{ title }}</h4> </div> <div class="modal-body"> {{ content }} </div> <div class="modal-footer"> <input type="button" class="btn btn-{{ type }}" data-dismiss="modal" value="{{ value }}"> </div> </div> </div> </div>',Dashboard.Templates.table='<table class="table {{ classes }}"> <thead><tr></tr></thead> <tbody></tbody> </table>',Dashboard.Templates.header='<div class="hi-desi-comp-header" id="{{ id }}" style="font-size: {{fontSize}}px; font-family: {{ fontFamily }},Helvetica,Arial,sans-serif,Times,serif,Courier; color: {{ color }}; background-color: {{ bgcolor }}; width: 100%; display: -webkit-box; display: -moz-box; display: -ms-box; display: -o-box; -webkit-box-align: center; -moz-box-align: center; -ms-box-align: center; -o-box-align: center; -webkit-box-pack: {{ align }}; -moz-box-pack: {{ align }}; -ms-box-pack: {{ align }}; -o-box-pack: {{ align }}; opacity: {{ bgOpacity }};" > {{ content }} </div>',Dashboard.Templates.text='<div id="{{ id }}" style="font-style: {{ fontsStyle }}; font-size: {{ fontSize }}px; font-weight: {{ fontsWeight }}; font-family: {{ fontFamily }},Helvetica,Arial,sans-serif,Times,serif,Courier; color: {{ color }}; display: -webkit-box; display: -moz-box; display: -ms-box; display: -o-box; -webkit-box-align: center; -moz-box-align: center; -ms-box-align: center; -o-box-align: center; -webkit-box-pack: {{ align }}; -moz-box-pack: {{ align }}; -ms-box-pack: {{ align }}; -o-box-pack: {{ align }}; opacity: {{ bgOpacity }}; width: 100%; white-space: pre-wrap;"> {{ textArea }} </div>',Dashboard.Templates.textComp='<div id="{{ id }}" style="height:100%;width:100%"> {{ textArea }} </div>',Dashboard.Templates.image='<div style="width:100%;height:100%"> <img class="img-responsive" src="{{ src }}" id="{{ id }}" alt="{{ alt }}" style="opacity: {{ bgOpacity }}; width:100%;height:100%"> </div>',Dashboard.Templates.imageComp='<div style="width:100%;height:100%"> <img class="img-responsive" src="{{ src }}" id="{{ id }}" alt="{{ alt }}" style="opacity: {{ bgOpacity }}; width:100%;height:100%"> </div>',Dashboard.Templates.separator='<hr style="border: {{borderWidth}} {{ borderStyle }} {{ borderColor }}; width: 100%; margin: 0 !important;">',Dashboard.Templates.background='<div id="bg-component" style="background:{{ imageURL }} {{ backgroundColor }}; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover; opacity: {{ bgOpacity }}; position: fixed; top: 0; left: 0; z-index: -1; height: 100%; width: 100%;"> </div>',Dashboard.Templates.pagebreak='<div class="page-break" id="{{ id }}"></div>',Dashboard.Templates.tabs='<ul class="nav nav-tabs">{{liMarkUp}}</ul>',ref=Dashboard.Templates;for(template in ref)hasProp.call(ref,template)&&(Dashboard.Templates[template]=_.template(Dashboard.Templates[template.trim()]));Dashboard.Defaults={},Dashboard.Defaults.button={display:"Submit",classes:"btn-primary"},Dashboard.Defaults.chart={menuLabel:"Actions"},Dashboard.Defaults.datepicker={displayFormat:"YYYY-MM-DD h:mm A",outputFormat:"YYYY-MM-DD h:mm A"},Dashboard.Defaults.daterangepicker={displayFormat:"YYYY-MM-DD",outputFormat:"YYYY-MM-DD"},Dashboard.Defaults.select2={placeholder:"Select an option"},Dashboard.Defaults.header={content:"Header",align:"left"},select=Backbone.View.extend({template:Dashboard.Templates.select,initialize:function(){this.listenTo(this.model,"change",this.render),this.model.get("_subjects")&&this.listenTo(this.model.get("_subjects"),"change",_.bind(this.model.update,this.model))},setupOptions:function(){if(this.options=this.model.get("options"),this.timer=!1,this.timeout=0,"string"!=typeof this.options.display)throw new Error("options.display is not specified for "+this.model.get("name"));if("string"!=typeof this.options.value)throw new Error("options.value is not specified for "+this.model.get("name"));return Boolean(this.options.multiple)?(this.options.multiple="multiple",this.timeout=1e3):this.options.multiple=""},bindings:{select:{observe:"value",events:["select.update"],onGet:function(t){var e;return e=$.isArray(t)?_.map(t,function(t){return String(t)}):String(t),"undefined"===e||"null"===e?"":e}}},close:function(){return this.unstickit(),this.$el.off(),this.$el.empty(),this.stopListening()},render:function(){var t,e,i,a,s,o;if(this.setupOptions(),template=$(this.template(this.options)),t=this.model.get("_data"),null!==t&&t.hasOwnProperty("data"))for(t=t.data,this.options.all&&(s={},s[this.options.display]="_all_",s[this.options.value]="_all_",t.unshift(s)),i=0,a=t.length;i<a;i++)e=t[i],template.append(Dashboard.Templates.option({value:e[this.options.value],display:e[this.options.display]}));return this.$el.empty().append(template),o=this,this.$el.on("change","select",function(t){var e;e=$.Event("select.update"),o.timer&&clearTimeout(o.timer),o.timer=setTimeout(function(){return $(t.target).trigger(e)},o.timeout)}),null!==this.model.get("_params")&&this.stickit(this.model.get("_params").at(0)),this}}),Dashboard.Components.select=select,select2=Backbone.View.extend({template:Dashboard.Templates.select2,initialize:function(){this.listenTo(this.model,"change",this.render),null!==this.model.get("_subjects")&&this.model.get("_subjects").on("change",_.bind(this.model.update,this.model))},setupOptions:function(){var t;if(this.options=this.model.get("options"),this.timer=!1,this.timeout=0,this.LIMIT=50,this.offset=0,this.values=this.model.get("_params")?this.model.get("_params").at(0).get("value"):[],t=this.model.get("name"),"string"!=typeof this.options.display)throw new Error("options.display is not specified for "+t);if("string"!=typeof this.options.value)throw new Error("options.value is not specified for "+t);if(this.options.multiple=Boolean(this.options.multiple),this.options.all=Boolean(this.options.all),this.options.multiple)return this.timeout=1e3},close:function(){return this.$("input[type=hidden]").select2("destroy"),this.unstickit(),this.$el.off(),this.$el.empty(),this.stopListening()},createDbFuncObj:function(t,e){var i,a;return null==e&&(e={}),i=this.model.get("column"),a={functionName:t,dataType:"text",parameters:{column:null!==e&&Object.keys(e).length?e:i}}},bindings:{"input[type=hidden]":{observe:"value",events:["select2.update"],update:function(t,e,i,a){t.select2("val",e),this.values=e},getVal:function(t,e,i){return this.values=t.select2("val"),t.select2("val")}}},getFormData:function(t,e){var i,a,s,o,n,r,l,d,p,h,c,u;return null==e&&(e=1),u=this,r={},r=_.clone(this.model.get("dataSource"))||{},this.model.get("columns")?(o=this.model.get("columns"),h=[],p=this.model.get("database"),o.forEach(function(t){var e,i;i=""!==p?p+"."+t.column.replace(/^\./,""):t.column.replace(/^\./,""),e=(t.alias?t.alias:"")||(t.column?t.column.replace(/\./g,"_"):""),h.push({column:i,alias:e})}),r.columns=h):(s=(this.model.get("database")+"."+this.model.get("column")).replace(/^\./,""),a=(this.model.get("alias")?this.model.get("alias"):"")||(this.model.get("column")?this.model.get("column").replace(/\./g,"_"):""),r.columns=[{column:s,alias:a}]),i=this.model.get("aggregate"),d=this.model.get("databaseFunction"),c=this.model.get("orderBy"),r.distinctResults=!0,r.functions={orderBy:[{alias:a,order:""!==c&&void 0!==c?c:"asc",custom:!0}]},d&&Object.keys(d).length&&r.columns.forEach(function(t){return t.databaseFunction=d}),Array.isArray(i)&&i.length&&("object"==typeof i[0]?(n=this.model.get("database"),i.forEach(function(t){var e;s=""!==n?n+"."+t.column.replace(/^\./,""):t.column.replace(/^\./,""),e=t.column.replace(/\./g,"_"),t.column=s,r.columns.forEach(function(t){t.column===s&&(t.aggregate=!0)})}),r.functions.aggregate=i,r.refresh=!0):(r.columns[0].aggregate=!0,s=(this.model.get("database")+"."+this.model.get("column")).replace(/^\./,""),a=this.model.get("alias")||this.model.get("column").replace(/\./g,"_"),r.functions.aggregate=[{column:s,"function":i.join("_"),alias:a}])),window.urlParameters&&window.urlParameters.refresh&&(r.refresh=!0),r.limitBy=this.LIMIT,r.offset=(e-1)*this.LIMIT,this.offset=(e-1)*this.LIMIT,t&&""!==t&&(r.filters=[{column:(this.model.get("database")+"."+this.model.get("column")).replace(/^\./,""),condition:"CUSTOM",customCondition:"LIKE",values:["%"+t+"%"]}],r.customFilterExpression="${0}",l=this.model.get("dataType"),l&&!l.match(new RegExp(["text"].join("|"),"i"))?r.filters[0].databaseFunction=u.createDbFuncObj("sql.text."+l+"ToString",d):d&&Object.keys(d).length&&(r.filters[0].databaseFunction=d)),r},render:function(){var t,e,i,a,s;return this.setupOptions(),template=$(this.template()),this.$el.empty().append(template),a=this,s=[],this.options.multiple?_.each(this.values,function(t){var e;e={},e.id=String(t),e.text=String(t),s.push(e)},this):s=this.values.length?{id:String(this.values[0]),text:String(this.values[0])}:"",this.model.get("dir")||this.model.get("map")?(t=this.model.get("_data"),e=[],null!==t&&t.hasOwnProperty("data")&&(this.options.all&&(i={},i.id="_all_",i.text="_all_",e.push(i)),t=t.data,_.each(t,function(t){i={},i.id=String(t[this.options.value]),i.text=String(t[this.options.display]),e.push(i)},this)),this.$el.empty().append(template),this.$("input[type=hidden]").select2({placeholder:this.options.placeholder||Dashboard.Defaults.select2.placeholder,width:"resolve",closeOnSelect:!1,data:e,multiple:this.options.multiple}).on("change",function(t){var e;e=$.Event("select2.update"),a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){return $(t.target).trigger(e)},a.timeout)})):this.$("input[type=hidden]").select2({minimumInputLength:0,placeholder:this.options.placeholder||Dashboard.Defaults.select2.placeholder,width:"resolve",closeOnSelect:!1,allowClear:!0,cache:!1,initSelection:function(t,e){e(s)},multiple:this.options.multiple,ajax:{url:window.DashboardGlobals.services,type:"POST",dataType:"json",quietMillis:500,data:function(t,e){return{type:"adhoc",serviceType:"report",service:"fetchData",formData:JSON.stringify(a.getFormData(t,e))}},results:function(t){var e,i,s;return 1!==t.status?{results:[]}:(i=[],a.options.all&&(s={},s.id="_all_",s.text="_all_",i.push(s)),e=t.response.data,_.each(e,function(t){s={},s.id=String(t[a.options.value]),s.text=String(t[a.options.display]),i.push(s)},a),{results:i,more:e.length>=a.LIMIT})},params:{_noBlock:!0}}}).on("change",function(t){var e;e=$.Event("select2.update"),a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){return $(t.target).trigger(e)},a.timeout)}),null!==this.model.get("_params")&&this.stickit(this.model.get("_params").at(0)),this}}),Dashboard.Components.select2=select2,checkbox=Backbone.View.extend({template:Dashboard.Templates.checkbox,initialize:function(){this.listenTo(this.model,"change",this.render),this.model.get("_subjects")&&this.listenTo(this.model.get("_subjects"),"change",_.bind(this.model.update,this.model))},setupOptions:function(){if(this.options=this.model.get("options"),this.timer=!1,this.timeout=0,"string"!=typeof this.options.display)throw new Error("options.display is not specified for "+this.model.get("name"));if("string"!=typeof this.options.value)throw new Error("options.value is not specified for "+this.model.get("name"));return Boolean(this.options.multiple)?(this.options.multiple="multiple",this.timeout=1e3):this.options.multiple=""},bindings:{select:{observe:"value",events:["checkbox.update"],onGet:function(t){var e;return e=$.isArray(t)?_.map(t,function(t){return String(t)}):String(t),this.value=e,this.$el.find("select").multiselectCheckBox("defaultSelectedOption",t),"undefined"===e||"null"===e?"":e}}},close:function(){return this.unstickit(),this.$el.off(),this.$el.empty(),this.stopListening()},render:function(){var t,e,i,a,s,o;if(this.setupOptions(),template=$(this.template(this.options)),t=this.model.get("_data"),null!==t&&t.hasOwnProperty("data"))for(t=t.data,this.options.all&&(s={},s[this.options.display]="_all_",s[this.options.value]="_all_",t.unshift(s)),i=0,a=t.length;i<a;i++)e=t[i],template.append(Dashboard.Templates.option({value:e[this.options.value],display:e[this.options.display]}));return this.$el.empty().append(template),o=this,this.$el.find("select[class=hi_checkbox]").val(this.value),this.$el.find("select[class=hi_checkbox]").multiselectCheckBox({columns:1,placeholder:"Select",search:!0,searchOptions:{"default":"Search"},selectAll:!0,onSelectAll:function(t,e){var i;return i=$.Event("checkbox.update"),o.timer&&clearTimeout(o.timer),o.timer=setTimeout(function(){if(t)return $(t).trigger(i)},o.timeout)},onOptionClick:function(t,e){var i;return i=$.Event("checkbox.update"),o.timer&&clearTimeout(o.timer),o.timer=setTimeout(function(){if(t)return $(t).trigger(i)},o.timeout)}}),null!==this.model.get("_params")&&this.stickit(this.model.get("_params").at(0)),this}}),Dashboard.Components.checkbox=checkbox,datepicker=Backbone.View.extend({template:Dashboard.Templates.datepicker,initialize:function(){this.model.update=null,this.listenTo(this.model,"change",this.render)},events:{"click .input-group-addon":"triggerFocus"},setupOptions:function(){if(this.options=this.model.get("options"),"string"==typeof this.options.displayFormat&&""!==this.options.displayFormat||(console.warn("Using default displayFormat as "+Dashboard.Defaults.datepicker.displayFormat+" for <b>"+this.model.get("name")+"</b>"),this.options.displayFormat=Dashboard.Defaults.datepicker.displayFormat),"string"!=typeof this.options.outputFormat||""===this.options.outputFormat)return console.warn("Using default outputFormat as "+Dashboard.Defaults.datepicker.outputFormat+" for <b>"+this.model.get("name")+"</b>"),this.options.outputFormat=Dashboard.Defaults.datepicker.outputFormat},close:function(){this.$("input[name=daterange]").data("daterangepicker").remove(),this.$el.off(),this.$el.empty(),this.unstickit(),this.stopListening()},triggerFocus:function(){this.$("input[name=date]").focus()},bindings:{"input[name=date]":{observe:"value",onGet:"toDisplay",onSet:"toModel",events:["hide.daterangepicker"],update:function(t,e,i,a){t.data("daterangepicker").setStartDate(e),t.data("daterangepicker").setEndDate(e),t.val(e)}}},toDisplay:function(t){return moment(t,this.options.outputFormat).format(this.options.displayFormat)},toModel:function(t){return moment(t,this.options.displayFormat).format(this.options.outputFormat)},render:function(){return this.setupOptions(),template=$(this.template()),this.$el.empty().append(template),template=null,this.$("input[name=date]").daterangepicker({locale:{format:this.options.displayFormat},showDropdowns:!0,singleDatePicker:!0,timePicker:!0}),null!==this.model.get("_params")&&this.stickit(this.model.get("_params").at(0)),this}}),Dashboard.Components.datepicker=datepicker,daterangepicker=Backbone.View.extend({template:Dashboard.Templates.daterangepicker,initialize:function(){this.model.update=null,this.listenTo(this.model,"change",this.render)},setupOptions:function(){return this.options=this.model.get("options"),"string"==typeof this.options.displayFormat&&""!==this.options.displayFormat||(this.options.displayFormat=Dashboard.Defaults.daterangepicker.displayFormat),"string"==typeof this.options.outputFormat&&""!==this.options.outputFormat||(this.options.outputFormat=Dashboard.Defaults.daterangepicker.outputFormat),this.options.separator=this.options.separator||" to "},close:function(){this.$("input[name=daterange]").data("daterangepicker").remove(),this.$el.off(),this.$el.empty(),this.unstickit(),this.stopListening()},events:{"click .input-group-addon":"triggerFocus"},triggerFocus:function(){this.$("input[name=daterange]").focus()},startDatebindings:{"input[name=daterange]":{observe:"value",onGet:"toStartDateDisplay",onSet:"toStartDateModel",events:["apply.daterangepicker"],update:function(t,e,i,a){var s;s="undefined"!=typeof this.model.get("_params").at(0)?this.model.get("_params").at(0).get("value"):"",s=e+moment(s,this.options.outputFormat).format(this.options.displayFormat),t.data("daterangepicker").setStartDate(e),t.val(s)}}},endDatebindings:{"input[name=daterange]":{observe:"value",onGet:"toEndDateDisplay",onSet:"toEndDateModel",events:["apply.daterangepicker"],update:function(t,e,i,a){var s;s="undefined"!=typeof this.model.get("_params").at(1)?this.model.get("_params").at(1).get("value"):"",s=moment(s,this.options.outputFormat).format(this.options.displayFormat)+" - "+e,t.data("daterangepicker").setEndDate(e),t.val(s)}}},toStartDateDisplay:function(t){return moment(t,this.options.outputFormat).format(this.options.displayFormat)},toStartDateModel:function(t){return t=t.split(" - ")[0],moment(t,this.options.displayFormat).format(this.options.displayFormat)},toEndDateDisplay:function(t){return moment(t,this.options.outputFormat).format(this.options.displayFormat)},toEndDateModel:function(t){return t=t.split(" - ")[1],moment(t,this.options.displayFormat).format(this.options.displayFormat)},render:function(){var t,e;return this.setupOptions(),template=$(this.template()),this.$el.empty().append(template),t={locale:{format:this.options.displayFormat},showDropdowns:!0,timePicker:!!this.options.timePicker,timePickerIncrement:_.isNumber(this.options.range)&&0<(e=this.options.range)&&e<60?this.options.timePickerIncrement:0,startDate:"undefined"!=typeof this.model.get("_params").at(0)?this.model.get("_params").at(0).get("value"):moment(),endDate:"undefined"!=typeof this.model.get("_params").at(1)?this.model.get("_params").at(1).get("value"):moment()},_.isBoolean(this.options.ranges)&&this.options.ranges===!0?t.ranges=Dashboard.Defaults.dateranges:_.isObject(this.options.ranges)&&(t.ranges=this.options.ranges),this.$("input[name=daterange]").daterangepicker(t),template=t=null,null!==this.model.get("_params")&&("undefined"!=typeof this.model.get("_params").at(0)&&this.stickit(this.model.get("_params").at(0),this.startDatebindings),"undefined"!=typeof this.model.get("_params").at(1)&&this.stickit(this.model.get("_params").at(1),this.endDatebindings)),this}}),Dashboard.Components.daterangepicker=daterangepicker,button=Backbone.View.extend({template:Dashboard.Templates.button,initialize:function(){return this.listenTo(this.model,"change",this.render)},setupOptions:function(){var t;this.options=this.model.get("options"),this.model.update=_.bind(this.trigger,this),this.options.classes=this.options.classes||Dashboard.Defaults.button.classes,this.options.display=this.options.display||Dashboard.Defaults.button.display,t=this.model.get("triggers")||[],this.toTrigger=new Backbone.VirtualCollection(Dashboard.components,{filter:function(e){return $.inArray(e.get("id"),t)>=0}}),_.bindAll(this,"trigger")},events:{"click button":"trigger"},trigger:function(){"undefined"!=typeof this.toTrigger&&this.toTrigger.each(function(t){"function"==typeof t.update&&t.update()})},close:function(){return this.$el.off(),this.$el.empty(),this.stopListening()},render:function(){return this.setupOptions(),template=$(this.template(this.options)),this.$el.empty().append(template),this}}),Dashboard.Components.button=button,chart=Backbone.View.extend({template:Dashboard.Templates.chart,initialize:function(){if(this.listenTo(this.model,"change",this.render),this.model.update=function(){var t,e,i,a,s,o,n,r;o=this,t={},t.dir=window.DashboardGlobals.efwddir||window.DashboardGlobals.folderpath,a=this.get("requestParameters");for(i in a)hasProp.call(a,i)&&(n=a[i],t[i]=Dashboard.getVariable(n));if("undefined"==typeof this.get("vf"))throw new Error("vf property isn't defined for "+this.get("name"));return r=this.get("vf"),t.vf_id=r.id,t.vf_file=r.file,r.dir&&(t.dir=r.dir),e=this.get("efwd"),e&&e.file&&(t.efwd=e),s=$.ajax({type:"POST",url:window.DashboardGlobals.chartingService,data:{data:window.Base64.encode(JSON.stringify(t).replace(/"(\[)\\/g,"$1").replace(/\\("\])"/g,"$1"))}}),s.identifier=this.get("name"),s.done(function(t,e,i){"string"==typeof t&&(t=JSON.parse(t)),o.set("_data",t)}),s.always(function(){})},null!==this.model.get("_subjects"))return this.listenTo(this.model.get("_subjects"),"change",_.bind(this.model.update,this.model))},setupOptions:function(){if(this.options=this.model.get("options"),"undefined"==typeof this.model.get("vf"))throw new Error("vf information is required for "+this.model.get("name")+" chart")},close:function(){return this.$el.off(),
this.$el.empty(),this.stopListening()},render:function(){var t,e,i,a,s,o,n,r,l,d;if(this.setupOptions(),null===this.model.get("_data"))return this;if(t=this.model.get("_data"),t.hasOwnProperty("id")&&t.hasOwnProperty("script")){if(template=$(this.template(t)),_.isArray(this.options.actions)&&this.options.actions.length>0){for(n=$(Dashboard.Templates.chartMenu({label:this.options.menuLabel||Dashboard.Defaults.chart.menuLabel})),r=n.find("ul.dropdown-menu"),l=this.options.actions,a=i=0,o=l.length;i<o;a=++i){e=l[a],a>0&&r.append(Dashboard.Templates.chartMenuItemSeparator());for(s in e)hasProp.call(e,s)&&(d=e[s],r.append(Dashboard.Templates.chartMenuItem({id:s,display:d})))}$(template[0]).append(n)}this.$el.empty().append(template)}return this}}),Dashboard.Components.chart=chart,adhoc=Backbone.View.extend({template:Dashboard.Templates.adhoc,initialize:function(){var t,e;t=this.model.get("options");try{t.report&&(t.dir=t.report.dir,t.file=t.report.file)}catch(i){console.warn("Dir and File doesn't exist!")}finally{t.dir=t.dir,t.file=t.file}return t&&!t.iframe&&void 0!==t.iframe?(e=this,$.ajax({type:"POST",url:window.DashboardGlobals.services,data:{type:"adhoc",serviceType:"report",service:"getReport",formData:window.Base64.encode(JSON.stringify({dir:t.dir,file:t.file}))}}).done(function(t){var i,a,s,o,n;n="string"==typeof t?JSON.parse(t):t,n.status&&(i=n.response,a={location:i.metadata.location,metadataFileName:i.metadata.metadataFileName},s=i.metadata.data.name,o=window.HDI.adhoc.stateTransformer?window.HDI.adhoc.stateTransformer(a,i.state,s):parent.window.HDI.adhoc.stateTransformer?parent.window.HDI.adhoc.stateTransformer(a,i.state,s):{},e.data=i,e.formDataForViz=o,e.model.update=e.renderFrame.bind(e),e.listenTo(e.model,"change",e.render),null!==e.model.get("_subjects")&&e.listenTo(e.model.get("_subjects"),"change",e.renderFrame),e.renderFrame())}).fail(function(t,i,a){var s;return s=e.options.uid?e.options.uid:e.model.get("uid"),this.div=document.createElement("div"),this.div.id="main"+s,this.div.style="height:100%;width:100%;overflow:auto",$("#"+s).empty().append(this.div),$("#main"+s).append("<span class='alert alert-danger' style='width:100vw'>"+a+"</span>")})):(this.model.update=this.renderFrame.bind(this),this.listenTo(this.model,"change",this.render),null!==this.model.get("_subjects")&&this.listenTo(this.model.get("_subjects"),"change",this.renderFrame),void 0)},close:function(){this.$el.empty()},setupOptions:function(){return this.options=this.model.get("options")},preExecution:function(t){var e;return e=new $.Deferred,t.isSet("preExecution")&&t.get("preExecution"),e.resolve(this,t),e.promise()},preFetch:function(t,e){var i;return i=new $.Deferred,e.isSet("preFetch")&&e.get("preFetch"),i.resolve(t,e),i.promise()},postFetch:function(t,e){var i;return i=new $.Deferred,e.isSet("postFetch")&&e.get("postFetch"),i.resolve(t,e),i.promise()},loadViz:function(t,e){var i,a;return i=new $.Deferred,a=e.get("renderId"),$.when(window.hi_vizManager.renderViz(t.data.state.visualisation.type,e.get("responseData"),e.get("viz_Options"),e.get("__hi_params"),a,e)).done(function(){$("#"+a).removeClass("hi-loading"),i.resolve(t,e)}).fail(function(t,e,i){$("#"+a).removeClass("hi-loading"),$("#main-"+a).html("<span class='alert alert-danger' style='width:100vw'>"+i+"</span>")}),i.promise()},scopeStyle:function(t,e,i){return _.each(document.styleSheets,function(i,a){var s,o,n,r,l,d,p,h;if(d=i.ownerNode,d&&d.id&&d.id===t){for(n=document.styleSheets[a].rules||document.styleSheets[a].cssRules,h=0,o=[];h<n.length;)s=n[h].selectorText.split(","),r=[],p="",s.length>1?(_.each(s,function(t){var i;i=e+t,r.push(i)}),p=r.join(",")):p=e+n[h].selectorText,n[h].cssText?o.push(n[h].cssText.replace(n[h].selectorText,p)):o.push(n[h].style.cssText.replace(n[h].selectorText,p)),h++;return $("#"+t).remove(),l=document.createElement("style"),l.type="text/css",l.id=t,l.textContent=o.join("  "),document.head.appendChild(l)}})},postExecution:function(t,e){var i;return i=new $.Deferred,e.isSet("postExecution")&&e.get("postExecution"),i.resolve(t,e),i.promise()},getData:function(t,e){var i,a,s,o;return s=this,o=e.get("renderId"),i=new $.Deferred,a={},e.isSet("requestData")&&(a=JSON.stringify(e.get("requestData")).trim()),$.post(window.DashboardGlobals.services,{type:"adhoc",serviceType:"report",service:"fetchData",formData:window.Base64.encode(a)}).done(function(a){return $("#"+o).removeClass("hi-loading"),0===a.status?void $("#main-"+o).html("<span class='alert alert-danger' style='width:100vw'>"+a.response.message+"</span>"):(e.isSet("responseData")?(e.unSet("responseData"),e.set("responseData",a.response)):e.set("responseData",a.response),void i.resolve(t,e))}).fail(function(t,e,i){$("#"+o).removeClass("hi-loading"),$("#main-"+o).html("<span class='alert alert-danger' style='width:100vw'>"+i+"</span>")}),i.promise()},renderFrame:function(){var __filters,__hi_params,_uid,baseUrl,data,dataSource,database,db_var,db_vars,filter,formDataForViz,hi_container,i,key,len,ref1,ref2,reportData,that,uid,url,value,viz_Options;that=this;try{this.options.report&&(this.options.dir=this.options.report.dir,this.options.file=this.options.report.file)}catch(error1){console.warn("Dir and File doesn't exist!")}finally{this.options.dir=this.options.dir,this.options.file=this.options.file}if(!this.options||!this.options.iframe&&void 0!==this.options.iframe){data=this.data,formDataForViz={},hi_container=new Container["default"],hi_container.set("iframe",this.options.iframe),_uid=that.options.uid?that.options.uid:that.model.get("uid"),Dashboard[_uid]={},dataSource={location:data.metadata.location,metadataFileName:data.metadata.metadataFileName},database=data.metadata.data.name,__filters=window.HDI.adhoc.getFilters?window.HDI.adhoc.getFilters(dataSource,data.state.filters,database):window.parent.HDI.adhoc.getFilters(dataSource,data.state.filters,database),Dashboard[_uid].getFilters=function(){return __filters},Dashboard[_uid].getAllVariables=function(){return(__filters||[]).reduce(function(t,e){return t[e.name]=e.values,t},{})},window.containerRefs?window.containerRefs[_uid]=hi_container:(window.containerRefs={},window.containerRefs[_uid]=hi_container),ref2=this.model.get("requestParameters");for(key in ref2)hasProp.call(ref2,key)&&(value=ref2[key],db_vars=Dashboard.getVariable(value),_.isArray(db_vars)&&data.state?(filter=_.find(data.state.filters,_.matchesProperty("label",key)),filter&&Object.keys(filter).length>0&&(filter.values=db_vars)):(filter=_.find(data.state.filters,_.matchesProperty("label",key)),filter&&Object.keys(filter).length>0&&(filter.values=[db_vars])));return data&&Object.keys(data).length>0&&(window.HDI.adhoc.stateTransformer?formDataForViz=window.HDI.adhoc.stateTransformer(dataSource,data.state,database):parent.window.HDI.adhoc.stateTransformer&&(formDataForViz=parent.window.HDI.adhoc.stateTransformer(dataSource,data.state,database))),window.__hi_result={},__hi_params={columns:window.Base64.encode(JSON.stringify(that.data.state.columns)),settings:window.Base64.encode(JSON.stringify(that.data.state.visualisation.settings)),scripts:window.Base64.encode(JSON.stringify(that.data.state.scripts)),customScripts:window.Base64.encode(JSON.stringify(that.data.state.customScripts)),styles:that.data.state.styles,customStyles:that.data.state.customStyles,database:that.data.metadata.data.name},window.urlParameters&&window.urlParameters.refresh&&(__hi_params.refresh=!0,formDataForViz.refresh=!0),hi_container.set("__hi_params",__hi_params),hi_container.isSet("requestData")?(hi_container.unSet("requestData"),hi_container.set("requestData",formDataForViz)):hi_container.set("requestData",formDataForViz),uid=that.options.uid?that.options.uid:that.model.get("uid"),$("#"+uid).addClass("hi-loading"),$("#"+uid).css("overflow","auto"),this.div=document.createElement("div"),this.div.id="main-"+uid,this.div.style="height:100%;width:100%;",$("#"+uid).empty().append(this.div),viz_Options={},hi_container.set("renderId",uid),window.hi_vizManager.getVizOptions(that.data.state.visualisation.type,function(t){viz_Options=t},__hi_params,uid,hi_container),hi_container.isSet("viz_Options")?(hi_container.unSet("viz_Options"),hi_container.set("viz_Options",viz_Options)):hi_container.set("viz_Options",viz_Options),reportData={formData:formDataForViz,columns:that.data.state.columns,viz_type:that.data.state.visualisation.type,settings:that.data.state.visualisation.settings,database:that.data.metadata.data.name,scripts:that.data.state.scripts,customScripts:that.data.state.customScripts,styles:that.data.state.styles,customStyles:that.data.state.customStyles},hi_container.isSet("reportData")?(hi_container.unSet("reportData"),hi_container.set("reportData",reportData)):hi_container.set("reportData",reportData),function(){var script,style,_customStyleId,_styleId,_uidString,_uidStringCustomStyles,customScripts,customStyles,e,scripts,style,styles;if(__hi_params&&__hi_params.scripts)try{scripts=window.Base64.decode(__hi_params.scripts),scripts=JSON.parse(scripts),scripts.map(function(scriptText){var id,script;id="scripts"+Math.random().toString(16).slice(2),script=document.createElement("script"),script.text="try { function scripts_"+id+"(hi_container){"+scriptText+"} } catch(e){console.error(e.trace)}",script.type="text/javascript",script.charset="utf-8",$("#"+uid).append(script),eval("scripts_"+id+"(hi_container)")})}catch(error1){e=error1}if(__hi_params&&__hi_params.styles)try{styles=__hi_params.styles,_uidString="#"+uid+" ",_styleId="style_"+uid,style=document.createElement("style"),style.type="text/css",style.id=_styleId,style.textContent=that.data.state.styles,$("#"+uid).append(style),that.scopeStyle(_styleId,_uidString,uid)}catch(error1){e=error1}if(__hi_params&&__hi_params.customScripts)try{customScripts=window.Base64.decode(__hi_params.customScripts),customScripts=JSON.parse(customScripts),customScripts.map(function(customScriptsText){var id,script;id="customScripts"+Math.random().toString(16).slice(2),script=document.createElement("script"),script.text="try { function customScripts_"+id+"(hi_container){"+customScriptsText+"} } catch(e){console.error(e.trace)}",script.type="text/javascript",script.charset="utf-8",$("#"+uid).append(script),eval("customScripts_"+id+"(hi_container)")})}catch(error1){e=error1}if(__hi_params&&__hi_params.customStyles)try{customStyles=__hi_params.customStyles,_uidStringCustomStyles="#"+uid+" ",_customStyleId="customStyle_"+uid,style=document.createElement("style"),style.type="text/css",style.id=_customStyleId,style.textContent=that.data.state.customStyles,$("#"+uid).append(style),that.scopeStyle(_customStyleId,_uidStringCustomStyles,uid)}catch(error1){e=error1}}(),window.navigator.userAgent.indexOf("PhantomJS")===-1&&"Table"===that.data.state.visualisation.type?this.preExecution(hi_container).then(this.preFetch).then(this.loadViz):this.preExecution(hi_container).then(this.preFetch).then(this.getData).then(this.postFetch).then(this.loadViz).then(this.postExecution)}baseUrl="report"===this.options.ext?window.DashboardGlobals.visualizeAdhoc:window.DashboardGlobals.openEfw,url=baseUrl+"?dir="+encodeURIComponent(this.options.dir)+"&file="+encodeURIComponent(this.options.file),ref1=this.model.get("requestParameters");for(key in ref1)if(hasProp.call(ref1,key))if(value=ref1[key],db_vars=Dashboard.getVariable(value),_.isArray(db_vars))for(i=0,len=db_vars.length;i<len;i++)db_var=db_vars[i],url+="&"+encodeURIComponent(key)+"="+encodeURIComponent(db_var);else url+="&"+encodeURIComponent(key)+"="+encodeURIComponent(db_vars);url+="&mode=dashboard",window.urlParameters&&window.urlParameters.refresh&&(url+="&refresh=true"),this.frame.src=url,window.navigator.userAgent.indexOf("PhantomJS")>-1&&setTimeout(function(){return that.$("iframe").css("width",that.$el[0].offsetWidth),that.$("iframe").css("height",that.$el[0].offsetHeight)},200)},render:function(){var t,e,i;this.setupOptions();try{""===this.options.styles.boxComp&&"undefined"===this.options.styles.boxComp||""===this.options.styles.boxPx||(e=document.querySelector("[data-gs-id='"+this.options.uid+"']"),e.style.boxShadow=""+this.options.styles.boxPx+" "+this.options.styles.boxColor)}catch(a){console.warn("These options doesn't exist!")}try{""===this.options.styles.boxComp&&"undefined"===this.options.styles.boxComp||""===this.options.styles.borderPx||(i=document.querySelector("[data-gs-id='"+this.options.uid+"']"),t=this.options.styles.borderStyle?this.options.styles.borderPx:"solid",i.style.border=""+this.options.styles.borderPx(0+t+" "+this.options.styles.borderColor))}catch(a){console.warn("These options doesn't exist!")}return this.frame=document.createElement("iframe"),this.frame.src="about:blank",this.frame.name=this.model.get("name"),this.frame.style.border="none",this.frame.style.width="100%",this.frame.style.minHeight="10px",this.$el.empty().append(this.frame),this}}),Dashboard.Components.adhoc=adhoc,table=Backbone.View.extend({template:Dashboard.Templates.table,initialize:function(){var t;this.options=this.model.get("options"),t=[],this.options.stripped&&t.push("table-stripped"),this.options.classes=t.join(" "),this.listenTo(this.model,"change:_data",this.render),null!==this.model.get("_subjects")&&this.model.get("_subjects").on("change",this.model.update)},render:function(){var t,e,i,a,s,o,n,r,l,d,p,h,c,u;if(template=$(this.template(this.options)),e=this.model.get("_data"),null!==e&&e.hasOwnProperty("data")&&e.data.length>0){for(u=[],c=[],e=e.data,t=$.isArray(this.options.columns)?this.options.columns:Object.keys(e[0]),s=0,l=e.length;s<l;s++){for(i=e[s],h=["<tr>"],o=0,d=t.length;o<d;o++)n=t[o],h.push("<td>"+i[n]+"</td>");h.push("</tr>"),c.push(h.join(""))}for(r=0,p=t.length;r<p;r++)a=t[r],u.push('<th data-column-id="'+a+'">'+a+"</th>");template.find("thead > tr").html(u.join("")).end().find("tbody").html(c.join(""))}return this.$el.empty().html(template),this.$el.find("table").bootgrid(),this}}),Dashboard.Components.table=table,header=Backbone.View.extend({template:Dashboard.Templates.header,initialize:function(){this.options=this.model.get("options")},render:function(){return""!==this.options.boxComp&&""!==this.options.boxPx&&(header=document.querySelector("[data-comp-type='"+this.options.boxComp+"']"),header.style.boxShadow=""+this.options.boxPx+" "+this.options.boxColor),this.options.fontFamily.indexOf(" ")>=0?this.options.fontFamily="'"+this.options.fontFamily+"'":this.options.fontFamily,template=$(this.template(this.options)),this.$el.empty().append(template),this}}),Dashboard.Components.header=header,image=Backbone.View.extend({template:Dashboard.Templates.image,template1:Dashboard.Templates.imageComp,initialize:function(){this.options=this.model.get("options")},render:function(){return Boolean(this.options.boxComp)&&this.options.hasOwnProperty("styles")&&Boolean(this.options.styles.boxPx)&&(header=document.querySelector("[data-comp-type='"+this.options.boxComp+"']"),header.style.boxShadow=""+this.options.boxPx+" "+this.options.boxColor),template=$(this.options.hasOwnProperty("addedFrom")?this.template1(this.options):this.template(this.options)),this.$el.empty().append(template),this}}),Dashboard.Components.image=image,separator=Backbone.View.extend({template:Dashboard.Templates.separator,initialize:function(){this.options=this.model.get("options")},render:function(){return template=$(this.template(this.options)),this.$el.empty().append(template),this}}),Dashboard.Components.separator=separator,custom=Backbone.View.extend({initialize:function(){if(this.setupOptions(),this.listenTo(this.model,"change",this.render),null!==this.model.get("_subjects"))return this.listenTo(this.model.get("_subjects"),"change",_.bind(this.model.update,this.model))},close:function(){return this.$el.off(),this.$el.empty(),this.stopListening()},setupOptions:function(){var t;t=this.$el,this.model.update=function(){var e;null!==this.get("_subjects")&&(e=_.object(this.get("_subjects").pluck("name"),this.get("_subjects").pluck("value"))),this.get("customScript").call(this,t,e)}},render:function(){return this.setupOptions(),this}}),Dashboard.Components.custom=custom,text=Backbone.View.extend({template:Dashboard.Templates.text,template1:Dashboard.Templates.textComp,initialize:function(){this.options=this.model.get("options")},render:function(){return this.options.hasOwnProperty("fontFamily")&&this.options.fontFamily.indexOf(" ")>=0&&(this.options.fontFamily="'"+this.options.fontFamily+"'"),template="",template=$(this.options.hasOwnProperty("addedFrom")?this.template1(this.options):this.template(this.options)),this.$el.empty().append(template),this}}),Dashboard.Components.text=text,background=Backbone.View.extend({template:Dashboard.Templates.background,initialize:function(){this.options=this.model.get("options")},windowResizer:function(){return $(window).load(function(){var t,e,i,a;a=$(window),t=$("#bg-component"),e=t.width()/t.height(),i=function(){return a.width()/a.height()<e?t.removeClass().addClass("bg-component-height"):void t.removeClass().addClass("bg-component-width")},a.resize(i).trigger("resize")})},render:function(){var t;return template=$(this.template(this.options)),this.$el.empty().append(template),t=document.getElementById("bg-component"),""!==this.options.imageURL?t.style.background="url('"+this.options.imageURL+"') no-repeat center center fixed":t.style.background=this.options.backgroundColor+" no-repeat center center fixed",this.options.imageURL&&this.options.backgroundColor&&(t.style.background="url('"+this.options.imageURL+"') no-repeat center center fixed"),t.style.backgroundSize="cover",this.$el.empty().append(template),this}}),Dashboard.Components.background=background,slider=Backbone.View.extend({template:Dashboard.Templates.slider,initialize:function(){this.listenTo(this.model,"change",this.render)},setupOptions:function(){var t;return this.options=this.model.get("options"),this.timer=!1,this.timeout=1e3,t=this.model.get("name")},zeroPad:function(t,e){var i;return i=e-t.toString().length+1,Array(+(i>0&&i)).join("0")+t},formatDT:function(t,e){var i,a,s,o,n,r;return r=t.getFullYear(),o=this.zeroPad(t.getMonth()+1,2),i=this.zeroPad(t.getDate(),2),"date"!==e?(a=this.zeroPad(t.getHours(),2),s=this.zeroPad(t.getMinutes(),2),n=this.zeroPad(t.getSeconds(),2),r+"-"+o+"-"+i+" "+a+":"+s+":"+n):r+"-"+o+"-"+i},close:function(){return this.$("div[type=rangeslider]").slider("destroy"),this.$el.off(),this.$el.empty(),this.stopListening(),this.unstickit()},sliderBindings:{"input[name=rangeValues]":{observe:"value",onSet:function(t){return t=t.split(",")},onGet:function(t){return t},events:["slider.update"],update:function(t,e,i,a){var s,o;"undefined"!=typeof this.model.get("_params").at(0)?o=this.model.get("_params").at(0).get("value"):(o=e,console.error("There is no parameter called ",this.model.get("_params").at(0).get("value")," to set")),s=[moment.ISO_8601,"YYYY/MM/DD"],a=this.model.get("options"),("numeric"===a.dataType||moment(o[0],s,!0).isValid())&&$(this.el).find("input[name=rangeValues]").val(o)}}},render:function(){var t,e,i,a,s,o;return this.setupOptions(),template=$(this.template()),this.$el.empty().append(template),t=this.model.get("_data"),null!==t&&(i=this,o=[],o="dateTime"===this.options.dataType||"date"===this.options.dataType?"undefined"!=typeof this.model.get("_params").at(0)?this.model.get("_params").at(0).get("value"):["2000-01-01 00:34:44.0","2070-01-01 16:37:43.0"]:"undefined"!=typeof this.model.get("_params").at(0)?this.model.get("_params").at(0).get("value"):[0,100],a=Date.parse(String(o[0]).replace(/\-/gi,"/").split(".")[0])/1e3,s=Date.parse(String(o[1]).replace(/\-/gi,"/").split(".")[0])/1e3,e={range:!0,min:null!==t&&t.hasOwnProperty("data")&&t.data[0][this.options.min]?Date.parse(String(t.data[0][this.options.min]).replace(/\-/gi,"/").split(".")[0])/1e3:Date.parse("2000/01/01 00:34:44")/1e3,max:null!==t&&t.hasOwnProperty("data")&&t.data[0][this.options.max]?Date.parse(String(t.data[0][this.options.max]).replace(/\-/gi,"/").split(".")[0])/1e3:Date.parse("2070/01/01 16:37:43")/1e3,values:"dateTime"===this.options.dataType||"date"===this.options.dataType?[a,s]:o,step:10},"numeric"===this.options.dataType&&(e.min=t.hasOwnProperty("data")?t.data[0][this.options.min]:0,e.max=t.hasOwnProperty("data")?t.data[0][this.options.max]:100,delete e.step),isNaN(e.min)?this.$(i.el).find("div[type=rangeslider]").html('<span style="color:#a94442">Formats for the filter values are wrong.</span>'):this.$("div[type=rangeslider]").slider(e).on("slide",function(t,e){var a,s,o,n,r,l;a=i.options.dataType,"dateTime"===a||"date"===a?"dateTime"===a?(s=new Date(1e3*e.values[0]),r=i.formatDT(s,a)+".0",o=new Date(1e3*e.values[1]),n=i.formatDT(o,a)+".0",$(i.el).find("input[name=rangeValues]").val([r,n])):(s=new Date(1e3*e.values[0]),r=i.formatDT(s,a),o=new Date(1e3*e.values[1]),n=i.formatDT(o,a),$(i.el).find("input[name=rangeValues]").val([r,n])):$(i.el).find("input[name=rangeValues]").val(e.values),l=$.Event("slider.update"),i.timer&&clearTimeout(i.timer),i.timer=setTimeout(function(){return $(i.el).find("input[name=rangeValues]").trigger("slider.update")},i.timeout)}),template=e=null,null!==this.model.get("_params")&&"undefined"!=typeof this.model.get("_params").at(0)&&this.stickit(this.model.get("_params").at(0),this.sliderBindings)),this}}),Dashboard.Components.slider=slider,rangeSelection=Backbone.View.extend({template:Dashboard.Templates.rangeSelection,initialize:function(){this.listenTo(this.model,"change",this.render),null!==this.model.get("_subjects")&&this.model.get("_subjects").on("change",_.bind(this.model.update,this.model))},setupOptions:function(){var t;if(this.options=this.model.get("options"),t=this.model.get("name"),"string"!=typeof this.options.display)throw new Error("options.display is not specified for "+t);if("string"!=typeof this.options.value)throw new Error("options.value is not specified for "+t)},close:function(){return this.$("input[name=endValue_select]").select2("destroy"),this.unstickit(),this.$el.off(),this.$el.empty(),this.stopListening()},bindings:{"input[name=srtVal_select]":{observe:"value",events:["select2.update"],update:function(t,e,i,a){_.isArray(e)?t.select2("val",e[0]):t.select2("val",e)},getVal:function(t,e,i){return[t.select2("val"),this.model.get("_params").at(0).get("value")[1]]}},"input[name=endValue_select]":{observe:"value",events:["select2.update"],update:function(t,e,i,a){_.isArray(e)?t.select2("val",e[1]):t.select2("val",e)},getVal:function(t,e,i){return[this.model.get("_params").at(0).get("value")[0],t.select2("val")]}}},render:function(){var t,e,i;return this.setupOptions(),template=$(this.template()),t=this.model.get("_data"),e=[],null!==t&&t.hasOwnProperty("data")&&(t=t.data,_.each(t,function(t){var i;i={},i.id=String(t[this.options.value]),i.text=String(t[this.options.display]),e.push(i)},this)),this.$el.empty().append(template),i=this,this.$("input[name=endValue_select]").select2({placeholder:this.options.placeholder||Dashboard.Defaults.select2.placeholder,width:"resolve",closeOnSelect:!1,data:e,multiple:!1}).on("change",function(t){var e;e=$.Event("select2.update"),$(t.target).trigger(e)}),this.$("input[name=srtVal_select]").select2({placeholder:this.options.placeholder||Dashboard.Defaults.select2.placeholder,width:"resolve",closeOnSelect:!1,data:e,multiple:!1}).on("change",function(t){var e;e=$.Event("select2.update"),$(t.target).trigger(e)}),null!==this.model.get("_params")&&this.stickit(this.model.get("_params").at(0)),this}}),Dashboard.Components.rangeselection=rangeSelection,input=Backbone.View.extend({template:Dashboard.Templates.input,initialize:function(){this.listenTo(this.model,"change",this.render),this.model.get("_subjects")&&this.listenTo(this.model.get("_subjects"),"change",_.bind(this.model.update,this.model))},setupOptions:function(){return this.options=this.model.get("options"),this.timer=!1,this.timeout=500},bindings:{"input[name=input_control]":{observe:"value",onSet:function(t){return t},onGet:function(t){return t},events:["input.update"],update:function(t,e,i,a){var s;"undefined"!=typeof this.model.get("_params").at(0)?s=this.model.get("_params").at(0).get("value"):(s=e,console.error("There is no parameter called ",this.model.get("_params").at(0).get("value")," to set")),$("input[name=input_control]").val(s)}}},close:function(){return this.unstickit(),this.$el.off(),this.$el.empty(),this.stopListening()},render:function(){var t;return this.setupOptions(),template=$(this.template(this.options)),this.$el.empty().append(template),t=this,this.$el.on("input",function(e){var i;i=$.Event("input.update"),t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){return $(e.target).trigger(i)},t.timeout)}),null!==this.model.get("_params")&&this.stickit(this.model.get("_params").at(0)),this}}),Dashboard.Components.input=input}(window,document,jQuery||$HDI,_||_HDI,Backbone||BackboneHDI,Dashboard);
//# sourceMappingURL=dashboard.js.map
